# 在线广告产品逻辑

## 第三章 在线广告产品概览

组成部分： 面向需求方接口+面向供给方接口+中间投放系统以及匹配策略。

在线广告产品大致分为四类：

1. 合约产品广告
   - 线下广告衍生而来， CPT(Cost per time) + CPM(Cost per mille)
   - 服务于后续效果不宜直接衡量的品牌类广告主
   - 门户网站+视频网站较为常见
2. 竞价广告产品
   - 搜索广告，搜索关键字竞价
   - 演进为对页面关键词或者用户标签竞价产品ADN（Ad network）
   - 适用于效果类广告
3. 程序化交易广告产品
   - 以实时竞价为核心
4. 原生广告产品
   -通过原生方式共存

商业产品的设计原则：

1. 相对于产品功能，要特别关注产品中策略部分。
2. 要特别关注数据，让运营和产品优化形成闭环。
3. 在所有与使用者打交道的产品界面上，用户产品追求便捷性设计原则非常重要。

需求方层级组织与接口

1. 广告层次： 广告主、广告（推广）计划（campaign）、广告（推广）组（ad group）、广告创意（ad）
   - 广告主管理一个广告主的通用信息
   - Campaign对应于广告主的一次投放合同， 预算+时间范围+其他相关设置（投放网络+分配策略等）
   - ad group对应于一个具体的投放策略，主要设定受众定向条件+出价
   - ad 最终展示出来的素材

供给方管理接口  
供给端的资源组织主要分媒体（网站+移动应用）和广告位两个层次。媒体的操作主要包括，添加、删除广告位、查看各广告的运营数据等。

## 第四章 合约广告

1. 广告位合约
   - 缺点：无法做到按受众类型投放广告，也无法进行深入效果优化
   - 优点: 在强曝光属性的广告位上投放可以带来品牌冲击，长期独占有利于形成橱窗效应。
2. 受众定向
   - 受众定向方法概览：
      - 地域定向
      - 人口属性定向
      - 频道定向
      - 上下文定向
      - 行为定向
      - 精确位置定向
      - 重定向
      - 新客推荐定向
      - 团购
   - 受众定向标签体系
3. 展示量合约
   - 流量预测：
      - 售前指导：合理预测曝光总数。
      - 在线流量分配：一次曝光同时满足两个以上合约要求，需要通过依赖流量预估结果让在线分配算法达到高效和准确的目标。
      - 出价指导：帮助广告组预估
   - 流量塑性：某些情况下，主动地影响流量，利于合约的达成
   - 在线分配：通过供给节点和需求节点，以及他们之间的联系，进行分配

标签过于丰富=>供给节点数目上升=>流量收缩=>精准预测困难
展示量合约这类产品在人群标签非常丰富和精准时是无法有效运作的=>驱动竞价广告产品的原动力。

## 第五章 搜索与竞价广告

在线广告：搜索广告（sponsored search）、垂直搜索广告

### 搜索广告

广告主就某标的物的广告展示机会展开拍卖式的竞争，并根据竞争结果依次占据该广告展示的若干位置。  

1. 搜过广告产品形态
   - 上下文查询词为粒度，竞价方式售卖，CPC结算
   - 展示页一般分（南、北（黄金位置）、东）三个区域
   - 产品和技术特点：
     - 搜索广告的变现能力eCPM(effective converter per mille)远高于别的展示广告
     - 搜索广告的受众定向标签，上下文的搜索查询r(a,u,c)中u弱化，c更重要
     - 搜索广告展示与自然结果展示接近：有原生意味;更加精细的匹配策略和技术。
     - 互联网广告最主流的交易模式
2. 搜索广告产品新形式
   - 超越文字链的创意
      - 增加更多表现力的信息点（广告主的Logo，主要内容连接，电话等）
      - 直接展示结构化的广告摘要，甚至提供一些直接访问的功能。
   - 弱相关广告形式
      - 主打东区的广告，在合理和可解释的范围内增加相关性较低的泛化内容。
      - 例如一些品牌推广，以及同类品牌的推荐。
   - 原生化的探索
3. 搜索广告投放和优化策略
   - 查询扩展
      - 精确匹配、短语匹配、广泛匹配、否定匹配
   - 广告放置
      - 确定广告的相关性是否足够+确定广告的RPM是否足够
      - 个性化的放置广告，对于不太分辨广告的用户，尽量的占满北区的位置。

### 位置拍卖与机制设计

1. 定价问题
   - 整个竞价系统处于纳什均衡状态（对于最终位置排名竞价结果中的每条广告，其收益都比排在其他位置要高）
   - GSP(广义第二高阶)：对赢得每个位置的广告主，都按照他下一位置出价来收取费用。
   - VCG:对于赢得了某个位置的广告主，所付出的成本应该等于他占据这个位置对市场其他者带来的价值损害。
      - 整个市场是trueth-telling的，大家都找到了最佳状态
      - 理论上较为优越的策略
      - 单个广告位时，VCG退化为第二高价策略。
2. 市场保留价
   - 为了控制广告的质量和保持一定的而出售价格，为每个位置设置底价
   - 尤其是黄金位置（北区）广告，设置较高的底价
3. 价格挤压
   - ```r = u^k*bid(cpc)```
   - k为大于0实数，调高k强调用户和质量反馈的影响，降低k，鼓励市场竞争。

### 广告网络

实际销售中未通过合约售卖的广告流量（剩余流量），需要变现。广告网络是批量聚合各媒体剩余流量，按照人群或上下文标签流量切割方式售卖给广告主。

1. 广告网络产品形态,既有竞价也有合约
2. 产品特点
   - 竞价方式不向广告主做量的约定，根据变现能力（eCPM）决定
   - 广告网络会极力淡化媒体和广告位的概念（按人群售卖）
   - 商业角度优势：无约定，提高市场流动性；先充值，改善资金流
3. 广告网络产品策略
   - 广告检索： 倒排索引+更多关键字/标签
   - 广告排序：冷启动问题+稳健的点击率

### 竞价广告和合约广告的比较

1. 市场经济 vs 计划经济
2. 供给方（市场）：合约广告由媒体方完成，竞价广告由市场完成，需要设计宏观竞争机制。
3. 需求端：合约广告缺乏透明性，难深入优化。
4. 竞价广告优势
   - 精细的受众定向，市场效率大幅提升
   - 中小广告主逐渐参与竞价追，市场规模快速扩张
   - 数据的价值得以彰显，以数据为核心来组织和运营产品。

## 第六章 程序化交易广告

询价出价竞价在展示时进行，产生以实时竞价（RTB）为核心的程序化交易市场。RTB的产生，使得市场向透明的比价平台发展，即广告交易平台ADX。

### 实时竞价

用定制化标签指导广告投放是实时竞价的关键目标产品目标。“实时”指的是**需求方**实时，即每一次展示参与广告竞价。

实时竞价流程：

1. Cookie映射
   - 当供给方和需求双方都可以得到同样的用户不同时，需要映射。
   - 1.1 从广告主网站向DSP服务器发送cookie映射请求
   - 1.2 DSP与ADX服务器之间通信完成cookie映射
2. 广告请求
   - 2.1 用户浏览媒体网站
   - 2.2 媒体网站通过js或sdk向adx发送广告请求。
   - 2.3 adx向多个DSP传送URL或域名cookie，发起询价请求。DSP根据cookie决策是否参与竞价，如果参与，则返回自己的出价。ADX选出最高的DSP返回给媒体网站。
   - 2.4 媒体网站从胜出DSP拿到广告创意并展示。

实际中的问题：

1. 每次展示都有ADX服务器和多个DSP服务器参与，增加带宽成本。
2. 询价过程中，需要等待时间，对CTR有负面影响
3. DSP可以通过极低的出价竞争，虽不能获得流量，却可以低成本得到在媒体网站上的用户行为数据。存在潜在信息泄露风险。

### 其他程序化交易方式

1. 优选：只有一个需求方的程序化交易
2. 私有市场：媒体将拍卖限制在被邀请需求方的小范围内
3. 广告交易方式谱系：

> |      |    程序化交易    | 半程序化交易 |  有限销售  |
> | ------- | ------------ |  ---------- | ----------|
> | 供给方   |RTBD PMP 优选 | 网络优化     |CPM CPT |
> | 中间平台 | 广告交易平台  | 广告网络     |广告投放机| 
> | 需求方   | RTBS PMP 优选 | 交易终端    |    |

### 广告交易平台

即ADX，负责将媒体流量通过拍卖的方式售卖给DSP，类似证券交易的交易所， RTB是其中标配。一般通过CPM结算方式。

### 需求方平台

通过RTB购买广告的产品形态为需求方平台DSP。

核心特征：
1. RTB方式的流量购买
2. 需要支持需求方定制化的用户划分。

需求方平台产品策略： 先要经过检索、排序、定价几个阶段。完成广告选择后，增加了出价步骤。通过数据为核心。结合第二方或者第三方的数据的定制化标签。

在各种定制化标签中，重定向和look-alike的方法  

1. 出价策略： 通过历史的观察和预测得到市价的曲线，然后将一天的预算分配到那些市价较低的流量上。实际中会将该策略拓展到更多维度上，比如性别等。
2. 重定向
   - 目的：用于品牌广告；用于效果广告
   - 网站重定向（达到过广告主的网站的用户作为集合）
   - 个性化重定向
      - 根据品类和购买阶段等因素进行创意上的深度个性化
      - 关键点: 动态创意；推荐引擎；广告主商品库存实时接口。
   - 搜索重定向
      - 统计广告主网站中从搜索引擎来的流量，将其中频度最高的关键词作为搜索重定向词表。
   - 一般首选搜索重定向，该策略依赖与第一方数据。
3. 新客推荐
   - 对可能对自己产品感兴趣的潜在客户进行挖掘，look-like

### 供给方平台

平台逻辑：  

1. 检查优先销售的订单有无需求，包括CPT和CPM的合约。
2. 有需求则按照优先级和在线分配方案投放
3. 否则进入竞价流程
4. 从自运行广告主库中找到eCPM较高的，并估算广告网络中若干eCPM，两者之间得到候选。
5. 以4中结构做MRP，通过RTB接口向接入的个DSP实时询价。

实践中主要考虑的因素：  

1. 广告网络或DSP的分成模式和比例。
2. 他们各自的广告返回率。

### 数据加工与交易

1. 要提高定向的精准程度和人群覆盖率： 决定因素是数据的来源与质量。
2. 有价值的数据来源
   - 数据表示
   - 用户行为（决策行为，主动行为，半主动行为和被动行为）
   - 人口属性
   - 地理位置
   - 社交关系
3. 三方数据划分
   - 第一方： 广告主数据，数据量较少，但最重要，数据灵魂。
   - 第二方： 广告平台。
   - 第三方： 不直接参与广告交易的其他数据。
4. 数据平台管理
   - 数据管理平台DMP
   - 核心功能：
      - 可以为网站提供受众定向功能
      - 如果媒体网站授权，DMP可以提供接口对加工出来的用户标签进行变现。
      - 广告主网站可以通过DMP与广告才买渠道进行方便的数据对接。
5. 数据交易平台
   - 数据交易平台主要是聚合各种来源的在线用户行为数据，加工成有价值的用户标签，然后再市场上通过售卖这些标签来变现。

### 在线广告产品交互关系

1. 从媒体角度
    - 可以将广告位托管给广告网络，由广告网络决策广告投放
    - 可以将广告位对接到广告交易平台，以实时竞价方式变现。
    - 可以将广告位托管给SSP，同事对接多个广告网络和PMP接口。
2. 对广告网络
    - 可以直接与需求方产品对接，通过后者将广告流量售卖给广告主
    - 可以将剩余流量导入广告交易市场，通过实时竞价变现。

## 第七章 移动互联与原生广告

产品方向经常被称为内容即广告。

### 原生广告相关产品

1. 信息流广告
2. 搜索广告（内容与广告按照统一准则的统一排序将会是一个有价值的发展方向）
3. 软文广告（内容本身为了委婉的宣传某种产品而产生）
4. 联盟（选择推广对象，并按照自己控制方式进行推广）

### 移动广告的现状与挑战

1. 移动广告特点
   - 情境广告可能性
   - 大量潜在的本地化广告主
2. 移动广告的创意形式
   - 横幅、插屏、开屏、锁屏、推荐墙、积分墙
   - 积分墙价值（应用冲榜、游戏开服）
3. 移动广告的挑战
   - 应用生态赵成的行为数据割裂（实际中获取数据更加困难）
   - 许多PC时代广告主移动化程度不够，无法充分消化广告带来的流量。
   - 移动广告的产品形态需要革命（原生广告）

### 原生广告平台

1. 表现原生和意图原生
   - 表现原生： 广告的展示风格和样式变得与内容相一致
   - 意图原生： 广告的投放决策逻辑和内容产生相一致
2. 植入式原生广告
   - 广告平台提供的是结构化付费内容，
   - 挑战： 媒体参加让广告多了自由度，运营难度大大增加； 大量分行业、结构化的广告信息建立需要时间。

### 原生广告语程序化交易

原生广告的出发是否根据用户意图进行，在明确的提供用户意图的原生广告中，完全开放的进行RTB，很难控制付费结果的相关性。

对搜索而言，由于相关性，采用对于单个技术能力较强的原生广告网络。  
对于社交网络等平台，用户意图不明确，完全可以考虑用程序化交易的方式来运营。

## 第八章 在线广告产品时间

互联网市场主要三类资产可以变现： 数据、流量和品牌属性。

### 媒体实战

媒体变现决策示意图：
![媒体变现决策示意图](https://raw.githubusercontent.com/sharonrain/Learning-book/master/doc/ads/ads-pic/online-ads-product-1.JPG)

1. 媒体首先考虑的变现方式是原生广告。
2. 如果流量充分，可以自行运营原生广告平台
3. 如果流量不充分，合理的方案是与其他原生广告平台或相关行业的搜索广告提供商合作
4. 若采用一般广告形式，则需要判断媒体是否具有比较有价值的平拍属性。

### 广告主实战

广告主在线营销决策示意图：
![广告主在线营销决策示意图](https://raw.githubusercontent.com/sharonrain/Learning-book/master/doc/ads/ads-pic/online-ads-product-2.JPG)

1. 影响广告主在线营销推广方案的第一要素是推广的目的。
2. 对于直接效果类推广需求，需要特别重视垂直的行业入口渠道。

### 数据提供方实战

数据提供方变现决策示意图
![数据提供方变现决策示意图](https://raw.githubusercontent.com/sharonrain/Learning-book/master/doc/ads/ads-pic/online-ads-product-3.JPG)

1. 在线广告交易使得拥有数据、但是既不是广告主又不是媒体的组织也可以参与到其中。
2. 大量数据通过广告市场的变现可以通过直接运营广告产品进行， 也可以通过将数据售卖给需求方进行。
3. 当不具备开发和运行完整广告产品能力时，应该采用直接出售。

# 计算广告相关技术

## 第九章 计算广告技术概览

个性化系统与搜索系统都是互联网时代具有挑战性的大规模计算问题，由于数据规模要求，一般都采用检索加排序这类搜索这类系统架构，差别在于个性化系统会使用大量的用户特征。  

### 个性化系统框架

1. 个性胡按系统由四个主体部分构成：
    - 在线投放: 实时响应请求，完成决策
    - 分布式计算：离线数据处理
    - 流计算：在线实时反馈
    - 数据高速公路：连接以上三部分

    个性化系统一般框架
    ![个性化系统一般框架](https://raw.githubusercontent.com/sharonrain/Learning-book/master/doc/ads/ads-pic/online-ads-product-4.JPG)

2. 同一个企业中，会在不同业务之间尽可能共享离线和在线的两个计算平台以及所有的用户行为数据。

### 各类广告系统优化目标

1. 目标是提高广告产品的利润
    ![优化目标](https://raw.githubusercontent.com/sharonrain/Learning-book/master/doc/ads/ads-pic/online-ads-product-5.JPG)

2. 主要广告产品优化目标分解
    ![主要广告产品优化目标分解](https://raw.githubusercontent.com/sharonrain/Learning-book/master/doc/ads/ads-pic/online-ads-product-6.JPG)

### 计算广告系统架构

![计算广告系统架构](https://raw.githubusercontent.com/sharonrain/Learning-book/master/doc/ads/ads-pic/online-ads-product-7.JPG)

1. 广告投放引擎

主要模块：

- 广告投放机（最重要指标是每秒查询数以及广告决策的延迟）
- 广告检索（根据用户标签和页面标签从广告索引中查询符合条件的广告候选）
- 广告排序（会用到离线计算CRT和流计算得到实施点击率等）
- 收益管理（对局部广告排序结构做调整达到收益最优）
- 广告请求接口
- 定制化用户划分

2. 数据告诉公路

- 将在线投放的数据准实时传输到离线分布式计算平台与流计算平台。
- 同时有担负手机这些数据源的任务。

3. 离线计算数据

主要目标：
- 统计日志得到报表， dashboard
- 利用数据挖掘、机器学习技术进行受众定向、点击率预估、分配策略规划。

主要模块：
- 用户会话日志生成。
- 行为定向
- 上下文定向
- 点击率建模
- 分配规划
- 商业智能
- 广告管理系统

4. 在线数据处理

- 在线反作弊
- 计费
- 在线行为反馈
- 实时索引

5. 计算广告系统主要开源工具

- Nginx
- ZooKeeper
- Lucene全文检索引擎
- 跨语言通信接口Thrift
- 数据高速公路Flume
- 分布式数据处理平台Hadoop
- 特征在线缓存Redis
- 流计算Storm
- 搞笑迭代框架Spark

https://blog.csdn.net/exuejwa/article/details/52140153?locationNum=4&fps=1